Import csv

FUNCTION globalOption
    INPUT Option { global variable }

FUNCTION dollarAdd(x, y)
    RETURN $ x + y to 2 Decimal points

FUNCTION dollarMinus(x, y)
    RETURN $ x - y to 2 Decimal points

FUNCTION personName()
    name = userIDInput if in "ATM_Exam/main/UserInfo.txt"

FUNCTION bankingInfo(file_path)
    OPEN file_path and read as file
    accountFile = REPLACE "|||" with "|" in file with DELIMITER = '|'
    accountType = row[0] in accountFile

FUNCTION startProgram()
    WRITE "Please enter your User ID"
    INPUT userIDInput { global variable }
    IF userIDInput == "q" THEN
        Quit
    ENDIF

FUNCTION search_userID(file_path, userIDInput)
    OPEN file_path and read as file
    content = csv read item for item in file             
    ids = row[3] in content                               
    WHILE TRUE 
    TRY
        idIndex = INDEX ids in userIDInputs                              
        people = content[idIndex]                                
        RETURN = people[0:2]                                            
    EXCEPT ValueError
        CALL MainProgram()
    ENDWHILE

FUNCTION userAccountOption()
    name = search_userID(file_path, userIDInput)                              
    RETURN JOIN name

FUNCTION askingOption()
    WRITE "Welcome " + CALL userAccountOption + ". Please Enter an option"
    WRITE "1 For Deposits"
    WRITE "2 For Withdraws" 
    WRITE "3 For Balance"
    WRITE "q To Quit"

FUNCTION answerOption()
    askingOption()
    INPUT Option
    CASE Option of
        1: REPLACE 1 with Deposit
        2: REPLACE 2 with Withdraw
        3: REPLACE 3 with Balance
        q: quit()
    OTHERS
        MainProgram()
    ENDCASE                                                        
    RETURN replaceOption

FUNCTION openingOpeningAccData()
    return CALL bankingInfo("ATM_Exam/main/OpeningAccountsData.txt")

FUNCTION askingChequeOrSavings(answerOptionPass)
    WRITE "Which account do you wish to" + CALL answerOptionPass + "From:"
    IF userIDInput is in openOpeningAccData()                                              
        accountTypeIndex = INDEX userIDInput in openOpeningAccData()               
        peopleAcc = accountFile[accountTypeIndex]                                 
        WRITE "1 for peopleAcc[1] (peopleAcc[2])"      
    ENDIF
    IF userIDInput is in openOpeningAccData()                                             
        accountTypeIndex2 = INDEX userIDInput in openOpeningAccData() + 1                    
        IF accountTypeIndex2 < 6:                                           
            peopleAcc = accountFile[accountTypeIndex2]                               
            WRITE "2 for peopleAcc[1] (peopleAcc[2])"       
        ENDIf
    ENDIF 

FUNCTION chequeAndSavings(file_path)
    INPUT ChandSav

    IF answerOptionPass == Balance
        CASE ChandSav of
            1: ChandSav is 1
                IF userIDInput is in openingOpeningAccData()
                    accountTypeIndex = INDEX userIDInput in openOpeningAccData()               
                    peopleAcc = accountFile[accountTypeIndex]                                 
                    WRITE "peopleAcc[3]"
                    pass
                ENDIF
            2: ChandSav is 2 
                IF userIDInput is in openOpeningAccData()                                             
                    accountTypeIndex2 = INDEX userIDInput in openOpeningAccData() + 1                    
                    IF accountTypeIndex2 < 6:                                           
                        peopleAcc = accountFile[accountTypeIndex2]                               
                        WRITE "peopleAcc[3]" 
                    ENDIF
                ENDIF      
            OTHERS 
                CALL MainProgram()
        ENDCASE

    CASE ChandSav of
        1: ChandSav is 1
            IF userIDInput is in openOpeningAccData() 
                accountTypeIndex = INDEX userIDInput in openOpeningAccData() 
                peopleAcc = accountFile[accountTypeIndex]
                WRITE "How much do you wish to answerOptionPass ? Balance =  peopleAcc[3]"
                BREAK
            ENDIF
        2: ChandSav is 2
            IF userIDInput is in openOpeningAccData()
                accountTypeIndex2 = INDEX userIDInput in openOpeningAccData()  + 1
                IF accountTypeIndex2 < 6
                    peopleAcc = accountFile[accountTypeIndex]
                    WRITE "How much do you wish to answerOptionPass ? Balance =  peopleAcc[3]"
                    BREAK
                ENDIF
            ENDIF 
        3: ChandSav is q
            CALL quit()
        OTHERS
            CALL MainProgram()
    ENDCASE

FUNCTION changing_C_Or_S_Account(file_path)
    userInput = int(input())

    CASE answerOptionPass of
        1: answerOptionPass is Deposit
            1: ChandSav is 1
                IF userIDInput in accountType
                    accountTypeIndex = INDEX userIDInput in accountType                    
                    peopleAcc = accountFile[accountTypeIndex]                           
                    y = peopleAcc[3]                                              
                    z = [float(y)]                                                
                    WRITE CALL dollarAdd(z[0] + userInput)                           
                ENDIF
            2: ChandSav is 2
                IF userIDInput IN accountType
                    accountTypeIndex2 = accountType.index userIDInput + 1                   
                    IF accountTypeIndex2 < 6                                    
                        peopleAcc = accountFile[accountTypeIndex2]                      
                        y = peopleAcc[3]                                            
                        z = [float(y)]                                                
                        WRITE CALL dollarAdd(z[0], userInput)                       
                    ENDIF
                ENDIF
            3: ChandSav is q
                CALL quit()
        2: answerOptionPass is Withdraw
            1: ChandSav is 1
                IF userIDInput IN accountType
                    accountTypeIndex = INDEX userIDInput in accountType                  
                    peopleAcc = accountFile[accountTypeIndex]                        
                    y = peopleAcc[3]                                            
                    z = [float(y)]                                                
                    IF z[0] - userInput < 0                               
                        WRITE "Error"                                           
                        CALL MainProgram()                                    
                    ELSE                                                       
                        WRITE CALL dollarMinus(z[0], userInput)              
                    ENDIF
                ELIF ChandSave == "q"
                    CALL quit()
                ENDIF

    CASE Option of
        1: Option is 1
        CASE ChandSav of
            1: ChandSav is 1
                IF userIDInput in accountType
                    accountTypeIndex = INDEX userIDInput in accountType                    
                    peopleAcc = accountFile[accountTypeIndex]                           
                    y = peopleAcc[3]                                              
                    z = [float(y)]                                                
                    WRITE CALL dollarAdd(z[0] + userInput)                           
                ENDIF
            2: ChandSav is 2
                IF userIDInput IN accountType
                    accountTypeIndex2 = accountType.index userIDInput + 1                   
                    IF accountTypeIndex2 < 6                                    
                        peopleAcc = accountFile[accountTypeIndex2]                      
                        y = peopleAcc[3]                                            
                        z = [float(y)]                                                
                        WRITE CALL dollarAdd(z[0], userInput)                       
                    ENDIF
                ENDIF
            3: ChandSav is q
                CALL quit()
        ENDCASE

        2: Option is 2
        CASE ChandSav of
            1: ChandSav is 1
                IF userIDInput IN accountType
                    accountTypeIndex = INDEX userIDInput in accountType                  
                    peopleAcc = accountFile[accountTypeIndex]                        
                    y = peopleAcc[3]                                            
                    z = [float(y)]                                                
                    IF z[0] - userInput < 0                               
                        WRITE "Error"                                           
                        CALL MainProgram()                                    
                    ELSE                                                       
                        WRITE CALL dollarMinus(z[0], userInput)              
                    ENDIF
                ELIF ChandSave == "q"
                    CALL quit()
                ENDIF

            2: ChandSav is 2
                IF userIDInput IN accountType
                    accountTypeIndex2 = INDEX userIDInput in accountType + 1
                    IF accountTypeIndex2 < 6
                        peopleAcc = accountFile[accountTypeIndex2]
                        y = peopleAcc[3]
                        z = [float(y)]
                        IF z[0] - userInput < 0
                            WRITE "Error"                                           
                            MainProgram()
                        ENDIF
                    ENDIF
                ENDIF
            3: ChandSav is q
                CALL quit()
        ENDCASE
    ENDCASE

FUNCTION MainProgram()
    WHILE TRUE
    TRY
        CALL StartProgram()
        CALL search_userID(file_path, userIDInput)
        CALL userAccountOption()
        CALL askingOption()
        CALL askingChequeOrSavings()
        CALL chequeAndSavings(file_path) 
    EXCEPT
        CALL quit()
    ENDWHILE

